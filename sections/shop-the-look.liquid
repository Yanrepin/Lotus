{% schema %}
{
  "name": "Shop the Look",
  "settings": [
    {
      "type": "image_picker",
      "id": "shop_the_look_image",
      "label": "Background Image"
    },
    {
      "type": "checkbox",
      "id": "lazy_load",
      "label": "lazy load"
    },
    {
      "type": "product",
      "id": "product_1",
      "label": "Product 1"
    },
    {
      "type": "range",
      "id": "dot_1_x",
      "label": "Dot 1 X Position",
      "default": 50,
      "min": 0,
      "max": 100
    },
    {
      "type": "range",
      "id": "dot_1_y",
      "label": "Dot 1 Y Position",
      "default": 50,
      "min": 0,
      "max": 100
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Product 2"
    },
    {
      "type": "range",
      "id": "dot_2_x",
      "label": "Dot 2 X Position",
      "default": 50,
      "min": 0,
      "max": 100
    },
    {
      "type": "range",
      "id": "dot_2_y",
      "label": "Dot 2 Y Position",
      "default": 50,
      "min": 0,
      "max": 100
    },
    {
      "type": "product",
      "id": "product_3",
      "label": "Product 3"
    },
    {
      "type": "range",
      "id": "dot_3_x",
      "label": "Dot 3 X Position",
      "default": 50,
      "min": 0,
      "max": 100
    },
    {
      "type": "range",
      "id": "dot_3_y",
      "label": "Dot 3 Y Position",
      "default": 50,
      "min": 0,
      "max": 100
    },
    {
      "type": "product",
      "id": "product_4",
      "label": "Product 4"
    },
    {
      "type": "range",
      "id": "dot_4_x",
      "label": "Dot 4 X Position",
      "default": 50,
      "min": 0,
      "max": 100
    },
    {
      "type": "range",
      "id": "dot_4_y",
      "label": "Dot 4 Y Position",
      "default": 50,
      "min": 0,
      "max": 100
    }
  ],
  "presets": [
    {
      "name": "Shop the Look"
    }
  ]
}
{% endschema %}

<div class="shop-the-look">
  <div class="shop-the-look__image">
    <img
      srcset="
        {%- if section.settings.shop_the_look_image.width >= 165 -%}{{ section.settings.shop_the_look_image | image_url: width: 165 }} 165w,{%- endif -%}
        {%- if section.settings.shop_the_look_image.width >= 360 -%}{{ section.settings.shop_the_look_image | image_url: width: 360 }} 360w,{%- endif -%}
        {%- if section.settings.shop_the_look_image.width >= 533 -%}{{ section.settings.shop_the_look_image | image_url: width: 533 }} 533w,{%- endif -%}
        {%- if section.settings.shop_the_look_image.width >= 720 -%}{{ section.settings.shop_the_look_image | image_url: width: 720 }} 720w,{%- endif -%}
        {%- if section.settings.shop_the_look_image.width >= 940 -%}{{ section.settings.shop_the_look_image | image_url: width: 940 }} 940w,{%- endif -%}
        {%- if section.settings.shop_the_look_image.width >= 1066 -%}{{ section.settings.shop_the_look_image | image_url: width: 1066 }} 1066w,{%- endif -%}
        {{ section.settings.shop_the_look_image | image_url }} {{ section.settings.shop_the_look_image.width }}w
      "
      src="{{ section.settings.shop_the_look_image | image_url: width: 533 }}"
      sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
      alt="{{ section.settings.shop_the_look_image.alt | escape }}"
      class="motion-reduce"
      {% unless section.settings.lazy_load == false %}
        loading="lazy"
      {% endunless %}
      width="{{ section.settings.shop_the_look_image.width }}"
      height="{{ section.settings.shop_the_look_image.height }}"
    >
    {% for i in (1..4) %}
      <div
        class="shop-the-look-dot"
        data-product-index="{{ i }}"
        style="
          top: {% capture dot_y_key %}dot_{{ i }}_y{% endcapture %}{{ section.settings[dot_y_key] }}%;
          left: {% capture dot_x_key %}dot_{{ i }}_x{% endcapture %}{{ section.settings[dot_x_key] }}%;
        "
      >
        <div></div>
      </div>
    {% endfor %}
  </div>

  <div class="shop-the-look__product">
    {% for i in (1..4) %}
      <div class="shop-the-look-product-detail" data-product-index="{{ i }}" hidden>
        {% capture product_key %}product_{{ i }}{% endcapture %}
        {% assign product = section.settings[product_key] %}
        {% if product %}
          <a href="{{ product.url }}">
            <img
              srcset="
                {%- if product.featured_image.width >= 165 -%}{{ product.featured_image | image_url: width: 165 }} 165w,{%- endif -%}
                {%- if product.featured_image.width >= 360 -%}{{ product.featured_image | image_url: width: 360 }} 360w,{%- endif -%}
                {%- if product.featured_image.width >= 533 -%}{{ product.featured_image | image_url: width: 533 }} 533w,{%- endif -%}
                {%- if product.featured_image.width >= 720 -%}{{ product.featured_image | image_url: width: 720 }} 720w,{%- endif -%}
                {%- if product.featured_image.width >= 940 -%}{{ product.featured_image | image_url: width: 940 }} 940w,{%- endif -%}
                {%- if product.featured_image.width >= 1066 -%}{{ product.featured_image | image_url: width: 1066 }} 1066w,{%- endif -%}
                {{ product.featured_image | image_url }} {{ product.featured_image.width }}w
              "
              src="{{ product.featured_image | image_url: width: 533 }}"
              sizes="(min-width: {{ settings.page_width }}px) {{ settings.page_width | minus: 130 | divided_by: 4 }}px, (min-width: 990px) calc((100vw - 130px) / 4), (min-width: 750px) calc((100vw - 120px) / 3), calc((100vw - 35px) / 2)"
              alt="{{ product.featured_image.alt | escape }}"
              class="motion-reduce"
              {% unless section.settings.lazy_load == false %}
                loading="lazy"
              {% endunless %}
              width="{{ product.featured_image.width }}"
              height="{{ product.featured_image.height }}"
            >
            <p>{{ product.title }}</p>
            <p>{{ product.price | money }}</p>
          </a>
        {% else %}
          <p>No product selected</p>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>

<style>
  .shop-the-look {
    display: flex;
  }
  .shop-the-look__image {
    position: relative;
    width: 50%;
  }
  .shop-the-look__image img {
    width: 100%;
    height: auto;
  }
  .shop-the-look-dot {
    position: absolute;
    width: 20px;
    height: 20px;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    transform: translate(-50%, -50%);
    display: block;
  }
  .shop-the-look__product {
    width: 50%;
    padding: 20px;
  }
  .shop-the-look-product-detail[hidden] {
    display: none;
  }
</style>

<script>
  document.querySelectorAll('.shop-the-look-dot').forEach((dot) => {
    dot.addEventListener('click', (event) => {
      const index = event.target.dataset.productIndex;

      document.querySelectorAll('.shop-the-look-product-detail').forEach((detail) => {
        detail.hidden = detail.dataset.productIndex !== index;
      });
    });
  });
</script>
